<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Chat Agent MVP with Gemini API</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    #chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
    .message { margin: 10px 0; padding: 8px; border-radius: 5px; }
    .user { text-align: right; color: blue; background: #e6f3ff; }
    .agent { text-align: left; color: green; background: #e6ffe6; }
    #inputArea { margin-top: 10px; display: flex; gap: 10px; }
    #userInput { width: 70%; padding: 5px; }
    #sendBtn, #voiceBtn { padding: 5px 10px; cursor: pointer; }
    #voiceBtn.listening { background: #ffcccc; }
  </style>
</head>
<body>

<h2>AI Chat Agent MVP</h2>

<div id="chat"></div>

<div id="inputArea">
  <input type="text" id="userInput" placeholder="Type your message..." />
  <button id="sendBtn">Send</button>
  <button id="voiceBtn">ðŸŽ¤</button>
</div>

<script>
  const chat = document.getElementById('chat');
  const userInput = document.getElementById('userInput');
  const sendBtn = document.getElementById('sendBtn');
  const voiceBtn = document.getElementById('voiceBtn');

  // Dataset for keyword-based responses
  const dataset = [
    {
      keywords: ['about', 'company', 'maestros', 'software development'],
      answer: `MAESTROS OF SOFTWARE DEVELOPMENT
Where code meets artistry: crafting bespoke software solutions

Developing the right software solutions for your business and integrating complex systems is both an art and a science â€“ a symphony, if you like â€“ and itâ€™s what we do best.

Our expertise includes developing the right software solutions for your business and integrating complex systems.`
    },
    {
      keywords: ['cases', 'devsecops', 'project'],
      answer: `Cases - Project cases

The Power of DevSecOps: Achieving Speed and Security in Software Development
Explore how DevSecOps revolutionizes software development by prioritizing both speed and security.`
    },
    {
      keywords: ['about us', 'team', 'developers'],
      answer: `ABOUT US
We are continuously sourcing exceptional developers who posses a unique blend of creativity, innovation, and strategic thinking, as they bring a touch of artistry to their coding.`
    },
    {
      keywords: ['ai skills', 'machine learning', 'expertise'],
      answer: `AI SKILLS SHOWCASE
This chatbot demonstrates my ability to integrate the Gemini AI API with web technologies, combining natural language processing with voice input/output for a seamless user experience.`
    }
  ];

  // Add message to chat window
  function addMessage(text, sender) {
    const msgDiv = document.createElement('div');
    msgDiv.className = `message ${sender}`;
    msgDiv.textContent = text;
    chat.appendChild(msgDiv);
    chat.scrollTop = chat.scrollHeight;
  }

  // Speak text aloud
  function speak(text) {
    if ('speechSynthesis' in window) {
      const utterance = new SpeechSynthesisUtterance(text);
      window.speechSynthesis.speak(utterance);
    } else {
      addMessage('Text-to-speech not supported in this browser.', 'agent');
    }
  }

  // Voice recognition setup
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  let recognition;
  if (SpeechRecognition) {
    recognition = new SpeechRecognition();
    recognition.lang = 'en-US';
    recognition.continuous = false;
    recognition.interimResults = false;

    recognition.onresult = (event) => {
      const transcript = event.results[0][0].transcript;
      userInput.value = transcript;
      voiceBtn.classList.remove('listening');
      sendMessage();
    };

    recognition.onstart = () => {
      voiceBtn.classList.add('listening');
      voiceBtn.textContent = 'ðŸŽ¤ Listening...';
    };

    recognition.onend = () => {
      voiceBtn.classList.remove('listening');
      voiceBtn.textContent = 'ðŸŽ¤';
    };

    recognition.onerror = (event) => {
      voiceBtn.classList.remove('listening');
      voiceBtn.textContent = 'ðŸŽ¤';
      addMessage('Voice recognition error: ' + event.error, 'agent');
    };
  } else {
    voiceBtn.disabled = true;
    voiceBtn.textContent = 'Voice Not Supported';
  }

  // Check dataset for keyword matches
  function checkDataset(input) {
    const lowerInput = input.toLowerCase();
    for (const entry of dataset) {
      if (entry.keywords.some(keyword => lowerInput.includes(keyword))) {
        return entry.answer;
      }
    }
    return null;
  }

  // Call Gemini API
  async function callGeminiAPI(userText) {
    const apiKey = 'AIzaSyD1rrdR9nJs3TJCFYNlp1FfFWwhcJxoImo'; // Replace with your key or move to backend
    const url = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent';

    const body = {
      contents: [
        {
          parts: [
            { text: userText }
          ]
        }
      ]
    };

    try {
      const response = await fetch(url + '?key=' + apiKey, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(body)
      });

      if (!response.ok) {
        console.error('Gemini API error:', response.status, response.statusText);
        return 'Sorry, I am having trouble connecting to the AI service.';
      }

      const data = await response.json();
      const generatedText = data?.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, I did not understand that.';
      return generatedText;

    } catch (error) {
      console.error('Fetch error:', error);
      return 'Error connecting to AI service.';
    }
  }

  // Send message handler
  async function sendMessage() {
    const input = userInput.value.trim();
    if (!input) {
      addMessage('Please enter a message.', 'agent');
      return;
    }

    addMessage(input, 'user');
    userInput.value = '';

    // Check dataset first
    const datasetReply = checkDataset(input);
    if (datasetReply) {
      addMessage(datasetReply, 'agent');
      speak(datasetReply);
      return;
    }

    // Show loading message
    addMessage('Thinking...', 'agent');
    const aiReply = await callGeminiAPI(input);
    chat.lastChild.remove(); // Remove "Thinking..." message
    addMessage(aiReply, 'agent');
    speak(aiReply);
  }

  // Event listeners
  sendBtn.addEventListener('click', sendMessage);
  userInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') sendMessage();
  });
  voiceBtn.addEventListener('click', () => {
    if (recognition) recognition.start();
  });

</script>

</body>
</html>
